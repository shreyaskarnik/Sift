<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <header class="popup-header">
    <div class="popup-brand">
      <h1>Sift</h1>
      <span class="version">v0.1</span>
    </div>
    <div class="status-pill">
      <span id="status-dot" class="status-dot"></span>
      <span id="status-label" class="status-label">â€”</span>
    </div>
  </header>

  <div class="popup-body">
    <div class="hero-card">
      <div class="hero-header">
        <span class="hero-label">ğŸ§­ Current Page</span>
        <label class="toggle toggle-compact">
          <input type="checkbox" id="toggle-page-score">
          <span class="toggle-switch"></span>
        </label>
      </div>
      <div id="page-score-card" class="page-score-card disabled">
        <div class="page-score-title" id="page-score-title">Enable scoring to see page relevance</div>
        <div class="page-score-row" id="page-score-row" style="display:none">
          <span class="page-score-band" id="page-score-band"></span>
          <span class="page-score-value" id="page-score-value"></span>
          <span class="page-score-actions" id="page-score-actions"></span>
        </div>
        <div class="page-score-anchors" id="page-score-anchors" style="display:none"></div>
        <div class="page-score-explain" id="page-score-explain" style="display:none"></div>
      </div>
    </div>

    <details class="fold fold-settings">
      <summary>âš™ï¸ Settings</summary>
      <div class="fold-content">
        <section id="model-section">
          <div class="model-row">
            <span class="model-name">Scoring</span>
            <span id="model-status" class="model-detail">Initializing...</span>
          </div>
          <div id="model-id-display" class="model-id-display"></div>
          <div id="progress-bar-container" style="display:none">
            <div id="progress-bar"></div>
          </div>
        </section>

        <section id="settings-section">
          <label>ğŸŒ Active Sites</label>
          <div class="toggle-row">
            <label class="toggle"><input type="checkbox" id="toggle-hn" checked><span class="toggle-switch"></span> HN</label>
            <label class="toggle"><input type="checkbox" id="toggle-reddit" checked><span class="toggle-switch"></span> Reddit</label>
            <label class="toggle"><input type="checkbox" id="toggle-x" checked><span class="toggle-switch"></span> X</label>
          </div>
          <label>ğŸ¯ Focus Lens</label>
          <div class="lens-active" id="lens-active">
            <span class="lens-icon">â—</span>
            <span class="lens-text" id="lens-text">News</span>
            <button class="lens-edit-btn" id="lens-edit-btn" title="Change lens">âœ</button>
          </div>
          <div class="lens-editor" id="lens-editor" style="display:none">
            <div class="lens-presets" id="lens-presets">
              <!-- Populated dynamically from active categories -->
            </div>
          </div>
          <label for="sensitivity-slider">Dimming <span id="sensitivity-value" class="slider-value">50%</span></label>
          <div class="slider-row">
            <span class="slider-hint">Subtle</span>
            <input type="range" id="sensitivity-slider" min="0" max="100" value="50">
            <span class="slider-hint">Aggressive</span>
          </div>
          <label for="model-source-input">ğŸ¤– Model Source <small>(blank = default)</small></label>
          <div class="input-row">
            <input type="text" id="model-source-input" placeholder="org/model-ONNX or http://localhost:8000">
            <button id="save-model-source">Apply</button>
          </div>
        </section>

        <footer>
          <p>Sift through the noise â€” powered by EmbeddingGemma.</p>
        </footer>
      </div>
    </details>

    <details class="fold fold-categories">
      <summary>ğŸ·ï¸ Categories <span id="category-count-badge" class="fold-badge"></span></summary>
      <div class="fold-content">
        <div id="category-grid" class="category-grid"></div>
      </div>
    </details>

    <details class="fold fold-data">
      <summary>ğŸ§ª Training Data <span id="label-count-badge" class="fold-badge"></span></summary>
      <div class="fold-content">
        <div id="label-counts">No labels collected yet.</div>
        <div id="data-readiness" class="data-readiness"></div>
        <div id="anchor-gap-hints" class="anchor-gap-hints" style="display:none"></div>
        <a id="collect-link" class="collect-link" href="https://news.ycombinator.com/" target="_blank" rel="noreferrer">
          Open an enabled site to collect labels
        </a>
        <div class="button-group">
          <button id="export-csv">Export CSV</button>
          <label class="file-input-label" for="import-x">
            Import X Archive
            <input type="file" id="import-x" accept=".js" multiple style="display:none">
          </label>
        </div>
        <button id="clear-data" class="danger">Clear All Data</button>
      </div>
    </details>
  </div>
  <div id="toast-container" class="toast-container" aria-live="polite"></div>
  <script src="popup.js"></script>
</body>
</html>
